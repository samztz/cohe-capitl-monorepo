# Mobile App WalletConnect Integration Context

## ğŸ“… Last Updated: 2025-10-30

## âœ… Completed Work

### WalletConnect Integration Refactor
- **From**: `@walletconnect/modal-react-native` (deprecated)
- **To**: `@reown/appkit-react-native` (official Reown AppKit)

### Files Modified/Created

1. **apps/mobile/src/config/AppKitConfig.ts** (NEW)
   - AppKit configuration with Ethers adapter
   - BSC Mainnet & Testnet support
   - AsyncStorage integration
   - PROJECT_ID: e1d4344896342c6efb5aab6396d3ae24

2. **apps/mobile/src/providers/AppProviders.tsx** (MODIFIED)
   - Added `AppKitProvider` wrapper
   - Added `<AppKit />` component for modal UI
   - Absolute positioning fix for Android

3. **apps/mobile/src/screens/auth/ConnectScreen.tsx** (MODIFIED)
   - Uses `useAppKit()` and `useAppKitAccount()` hooks
   - Auto-navigation after connection
   - Address formatting (0xAb...1234)

4. **apps/mobile/babel.config.js** (ALREADY CONFIGURED)
   - `unstable_transformImportMeta: true` for valtio support
   - `react-native-reanimated/plugin`

### Dependencies Added
```json
{
  "@reown/appkit-react-native": "latest",
  "@reown/appkit-ethers-react-native": "latest",
  "viem": "^2.x"
}
```

### Dependencies Removed
```json
{
  "@walletconnect/modal-react-native": "removed",
  "@reown/walletkit": "removed"
}
```

## ğŸ› Issues Fixed

1. **Missing viem package** - Added viem@2.x
2. **Metro bundler temp file conflicts** - Cleaned abitype temp directories
3. **import.meta support** - Already configured in babel

## ğŸš€ Current Status

- Dev server running on `http://localhost:8081`
- Background process: bash_id `2ca4b1`
- Metro bundler compiling...
- Ready for device testing

## ğŸ“‹ Next Steps

1. Wait for Metro compilation to complete
2. Test on device/emulator
3. Click "Connect Wallet" button
4. Verify AppKit modal opens
5. Connect wallet and test session persistence

## âš ï¸ Known Constraints

- Must use Expo Dev Client (not Expo Go)
- Requires native build for full functionality
- Android modal needs absolute positioning workaround

## ğŸ”— Important References

- WalletConnect PROJECT_ID: e1d4344896342c6efb5aab6396d3ae24
- Target chains: BSC (56), BSC Testnet (97)
- App scheme: `cohecapitl://`
- API base: `http://localhost:3001`

## ğŸ“ Architecture Notes

```
App.tsx
  â””â”€ AppProviders.tsx
      â”œâ”€ QueryClientProvider
      â”œâ”€ AppKitProvider (instance={appKit})
      â”‚   â””â”€ PaperProvider
      â”‚       â”œâ”€ {children} (RootNavigator)
      â”‚       â””â”€ <AppKit /> (modal UI)
      â””â”€ AppKitConfig.ts
          â”œâ”€ EthersAdapter
          â”œâ”€ AsyncStorage
          â””â”€ networks: [bsc, bscTestnet]
```

## ğŸ”„ If Issues Occur

**Metro bundler errors:**
```bash
# Clean temp files
find node_modules/.pnpm -name "*_tmp_*" -type d -exec rm -rf {} +
rm -rf apps/mobile/.expo apps/mobile/node_modules/.cache

# Restart
pnpm --filter mobile start -- --clear
```

**Module resolution errors:**
```bash
# Check viem is installed
pnpm list viem

# Reinstall if needed
pnpm --filter mobile add viem@2.x
```
