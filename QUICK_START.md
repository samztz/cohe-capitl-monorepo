# ğŸš€ å¿«é€Ÿå¼€å§‹ï¼š3 æ­¥éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

## ğŸ“‹ æ¦‚è§ˆ

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ åœ¨ **15 åˆ†é’Ÿå†…**å®Œæˆç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ã€‚

**æµç¨‹**ï¼š
```
æœ¬åœ°å‡†å¤‡ (5åˆ†é’Ÿ) â†’ æœåŠ¡å™¨é…ç½® (5åˆ†é’Ÿ) â†’ éƒ¨ç½²ä¸Šçº¿ (5åˆ†é’Ÿ)
```

---

## ç¬¬ä¸€æ­¥ï¼šæœ¬åœ°å‡†å¤‡ï¼ˆ5 åˆ†é’Ÿï¼‰

### 1.1 è¿è¡Œå‡†å¤‡è„šæœ¬

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
./scripts/prepare-production.sh
```

**è„šæœ¬ä¼šè¯¢é—®ä½ ä¸¤ä¸ªé—®é¢˜**ï¼š

#### é—®é¢˜ 1ï¼šä½ çš„åŸŸåæ˜¯ä»€ä¹ˆï¼Ÿ
```
è¯·è¾“å…¥ä½ çš„åŸŸåï¼ˆä¾‹å¦‚ï¼šexample.comï¼‰:
```

**ä½ éœ€è¦è¾“å…¥**ï¼š
- âœ… **å¦‚æœæœ‰åŸŸå**ï¼šè¾“å…¥ `yourdomain.com`ï¼ˆä¸è¦åŠ  `https://` å’Œ `www`ï¼‰
- âš ï¸ **å¦‚æœæš‚æ—¶æ²¡åŸŸå**ï¼šç›´æ¥æŒ‰å›è½¦ï¼ˆä½¿ç”¨å ä½ç¬¦ `your-domain.com`ï¼‰

**ç¤ºä¾‹**ï¼š
```
è¯·è¾“å…¥ä½ çš„åŸŸåï¼ˆä¾‹å¦‚ï¼šexample.comï¼‰: cohe-capital.com
âœ“ åŸŸå: cohe-capital.com
```

#### é—®é¢˜ 2ï¼šWalletConnect Project ID æ˜¯ä»€ä¹ˆï¼Ÿ
```
è¯·è¾“å…¥ WalletConnect Project ID (ä» https://cloud.reown.com/ è·å–):
```

**ä½ éœ€è¦åš**ï¼š
1. è®¿é—® https://cloud.reown.com/
2. æ³¨å†Œ/ç™»å½•è´¦å·ï¼ˆå…è´¹ï¼‰
3. åˆ›å»ºæ–°é¡¹ç›®
4. å¤åˆ¶ Project IDï¼ˆç±»ä¼¼ `e1d4344896342c6efb5aab6396d3ae24`ï¼‰
5. ç²˜è´´åˆ°ç»ˆç«¯

**ç¤ºä¾‹**ï¼š
```
è¯·è¾“å…¥ WalletConnect Project ID: e1d4344896342c6efb5aab6396d3ae24
âœ“ WalletConnect ID: e1d4344896342c6efb5aab6396d3ae24
```

---

### 1.2 è„šæœ¬å®Œæˆåä¼šæ˜¾ç¤ºä»€ä¹ˆï¼Ÿ

è„šæœ¬è¿è¡Œå®Œæˆåï¼Œä½ ä¼šçœ‹åˆ°ï¼š

```
ğŸ”‘ é‡è¦ä¿¡æ¯ï¼ˆè¯·å¦¥å–„ä¿ç®¡ï¼‰

ä»¥ä¸‹æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„å¯†é’¥ï¼Œè¯·ä¿å­˜åˆ°å®‰å…¨çš„åœ°æ–¹ï¼š

Admin Token (ç®¡ç†å‘˜ç™»å½•ä»¤ç‰Œ):
  4f8a2b9c3d6e1f7a0b5c8d2e9f3a6b1c4d7e0f3a6b9c2d5e8f1a4b7c0d3e6f9a

æ•°æ®åº“å¯†ç :
  Y0urStr0ngP@ssw0rd2024!

âš ï¸  è¿™äº›å¯†é’¥åªæ˜¾ç¤ºä¸€æ¬¡ï¼Œå»ºè®®å¤åˆ¶åˆ°å¯†ç ç®¡ç†å™¨
```

**ä½ éœ€è¦åš**ï¼š
1. âœ… **å¤åˆ¶ Admin Token**ï¼ˆä¿å­˜åˆ°å®‰å…¨çš„åœ°æ–¹ï¼Œå¦‚å¯†ç ç®¡ç†å™¨ï¼‰
2. âœ… **å¤åˆ¶æ•°æ®åº“å¯†ç **ï¼ˆå¯é€‰ï¼Œä¸€èˆ¬ä¸éœ€è¦ç›´æ¥ä½¿ç”¨ï¼‰

---

### 1.3 æ£€æŸ¥ç”Ÿæˆçš„æ–‡ä»¶

è„šæœ¬ä¼šè‡ªåŠ¨ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼š

#### æ–‡ä»¶ 1ï¼š`.env.production`ï¼ˆç¯å¢ƒå˜é‡ï¼‰

```bash
# æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶
cat .env.production
```

**æ£€æŸ¥ä»¥ä¸‹é…ç½®æ˜¯å¦æ­£ç¡®**ï¼š

| é…ç½®é¡¹ | åº”è¯¥æ˜¯ä»€ä¹ˆ | å¦‚ä½•æ£€æŸ¥ |
|--------|-----------|---------|
| `SIWE_DOMAIN` | ä½ çš„åŸŸå | åº”è¯¥æ˜¯ä½ è¾“å…¥çš„åŸŸåï¼ˆå¦‚ `cohe-capital.com`ï¼‰ |
| `SIWE_URI` | `https://ä½ çš„åŸŸå` | åº”è¯¥æ˜¯ `https://cohe-capital.com` |
| `CORS_ORIGIN` | åŒ…å« Web å’Œ Admin åŸŸå | åº”è¯¥æ˜¯ `https://cohe-capital.com,https://admin.cohe-capital.com` |
| `NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID` | ä½ çš„ Project ID | åº”è¯¥æ˜¯ä½ è¾“å…¥çš„ WalletConnect ID |
| `ADMIN_TOKEN` | éšæœºç”Ÿæˆçš„é•¿å­—ç¬¦ä¸² | åº”è¯¥æ˜¯ä¸€é•¿ä¸²å­—æ¯æ•°å­— |

**å¦‚æœéœ€è¦ä¿®æ”¹**ï¼š
```bash
nano .env.production
# ä¿®æ”¹åä¿å­˜ï¼ˆCtrl+X, Y, Enterï¼‰
```

#### æ–‡ä»¶ 2ï¼š`infra/nginx/nginx.prod.conf`ï¼ˆNginx é…ç½®ï¼‰

```bash
# æ£€æŸ¥åŸŸåæ˜¯å¦æ­£ç¡®æ›¿æ¢
grep "server_name" infra/nginx/nginx.prod.conf
```

**æœŸæœ›è¾“å‡º**ï¼š
```
server_name cohe-capital.com www.cohe-capital.com;    # Web åŸŸå
server_name admin.cohe-capital.com;                     # Admin åŸŸå
```

**å¦‚æœåŸŸåä¸å¯¹**ï¼ˆæ¯”å¦‚è¿˜æ˜¯ `your-domain.com`ï¼‰ï¼š
```bash
# æ‰‹åŠ¨æ›¿æ¢
sed -i 's/your-domain.com/cohe-capital.com/g' infra/nginx/nginx.prod.conf
```

---

### 1.4 æäº¤ä»£ç åˆ° Git

```bash
# 1. ç¡®ä¿ .env.production ä¸ä¼šè¢«æäº¤ï¼ˆéå¸¸é‡è¦ï¼ï¼‰
echo ".env.production" >> .gitignore

# 2. æŸ¥çœ‹ä¿®æ”¹çš„æ–‡ä»¶
git status

# 3. æäº¤ä»£ç ï¼ˆä¸åŒ…æ‹¬ .env.productionï¼‰
git add .
git commit -m "chore: ready for production deployment"
git push origin main
```

**âš ï¸ é‡è¦**ï¼š`.env.production` åŒ…å«æ•æ„Ÿå¯†é’¥ï¼Œ**ç»å¯¹ä¸èƒ½æäº¤åˆ° Git**ï¼

---

## ç¬¬äºŒæ­¥ï¼šæœåŠ¡å™¨é…ç½®ï¼ˆ5 åˆ†é’Ÿï¼‰

### 2.1 å‡†å¤‡æœåŠ¡å™¨

**ä½ éœ€è¦ä¸€å°æœåŠ¡å™¨**ï¼ˆä»¥ä¸‹ä»»é€‰å…¶ä¸€ï¼‰ï¼š

- âœ… äº‘æœåŠ¡å™¨ï¼ˆé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€AWSã€DigitalOcean ç­‰ï¼‰
- âœ… VPSï¼ˆVultrã€Linodeã€Hetzner ç­‰ï¼‰
- âœ… è‡ªå·±çš„æœåŠ¡å™¨

**æœ€ä½é…ç½®**ï¼š
- CPU: 2 æ ¸
- å†…å­˜: 4GB
- ç¡¬ç›˜: 20GB
- ç³»ç»Ÿ: Ubuntu 20.04+ / Debian 11+ / CentOS 8+

---

### 2.2 å®‰è£… Dockerï¼ˆé¦–æ¬¡éœ€è¦ï¼‰

SSH ç™»å½•åˆ°æœåŠ¡å™¨åï¼Œæ‰§è¡Œï¼š

```bash
# ä¸€é”®å®‰è£… Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# å¯åŠ¨ Docker
sudo systemctl start docker
sudo systemctl enable docker

# éªŒè¯å®‰è£…
docker --version
# åº”è¾“å‡ºï¼šDocker version 24.x.x

docker compose version
# åº”è¾“å‡ºï¼šDocker Compose version v2.x.x
```

---

### 2.3 é…ç½®é˜²ç«å¢™

```bash
# Ubuntu/Debian
sudo ufw allow 22/tcp    # SSHï¼ˆå¿…é¡»ï¼Œå¦åˆ™ä¼šæ–­å¼€è¿æ¥ï¼‰
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS
sudo ufw enable

# æ£€æŸ¥çŠ¶æ€
sudo ufw status
```

**æœŸæœ›è¾“å‡º**ï¼š
```
Status: active

To                         Action      From
--                         ------      ----
22/tcp                     ALLOW       Anywhere
80/tcp                     ALLOW       Anywhere
443/tcp                    ALLOW       Anywhere
```

---

### 2.4 é…ç½® DNSï¼ˆåœ¨åŸŸåæœåŠ¡å•†æ“ä½œï¼‰

**å¦‚æœä½ æœ‰åŸŸå**ï¼Œåœ¨åŸŸåæœåŠ¡å•†ï¼ˆå¦‚ Cloudflareã€é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ï¼‰æ·»åŠ  A è®°å½•ï¼š

| ç±»å‹ | ä¸»æœºå | å€¼ï¼ˆIPï¼‰ | è¯´æ˜ |
|------|--------|---------|------|
| A | @ | 123.45.67.89 | ä¸»åŸŸåï¼ˆcohe-capital.comï¼‰ |
| A | www | 123.45.67.89 | www å­åŸŸå |
| A | admin | 123.45.67.89 | Admin åå°å­åŸŸå |

**123.45.67.89** æ›¿æ¢ä¸ºä½ çš„æœåŠ¡å™¨å…¬ç½‘ IPã€‚

**éªŒè¯ DNS ç”Ÿæ•ˆ**ï¼ˆç­‰å¾… 5-10 åˆ†é’Ÿåï¼‰ï¼š
```bash
# åœ¨æœ¬åœ°ç”µè„‘æ‰§è¡Œ
nslookup cohe-capital.com
nslookup admin.cohe-capital.com
```

---

## ç¬¬ä¸‰æ­¥ï¼šéƒ¨ç½²ä¸Šçº¿ï¼ˆ5 åˆ†é’Ÿï¼‰

### 3.1 å…‹éš†ä»£ç åˆ°æœåŠ¡å™¨

```bash
# åœ¨æœåŠ¡å™¨æ‰§è¡Œ
git clone https://github.com/your-username/cohe-capital-monorepo.git
cd cohe-capital-monorepo
```

---

### 3.2 ä¸Šä¼  .env.production

**æ–¹æ³• Aï¼šä½¿ç”¨ SCPï¼ˆæ¨èï¼‰**

åœ¨**æœ¬åœ°ç”µè„‘**æ‰§è¡Œï¼š
```bash
# ä¸Šä¼ ç¯å¢ƒå˜é‡æ–‡ä»¶
scp .env.production user@æœåŠ¡å™¨IP:/path/to/cohe-capital-monorepo/

# ç¤ºä¾‹ï¼š
scp .env.production root@123.45.67.89:/root/cohe-capital-monorepo/
```

**æ–¹æ³• Bï¼šæ‰‹åŠ¨åˆ›å»º**

åœ¨**æœåŠ¡å™¨**æ‰§è¡Œï¼š
```bash
nano .env.production
# ç²˜è´´æœ¬åœ° .env.production çš„å†…å®¹
# ä¿å­˜ï¼ˆCtrl+X, Y, Enterï¼‰
```

**éªŒè¯æ–‡ä»¶å­˜åœ¨**ï¼š
```bash
ls -la .env.production
# åº”è¯¥çœ‹åˆ°æ–‡ä»¶
```

---

### 3.3 æ‰§è¡Œéƒ¨ç½²

```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x deploy.sh

# æ‰§è¡Œç”Ÿäº§éƒ¨ç½²ï¼ˆé¦–æ¬¡éƒ¨ç½²ï¼‰
./deploy.sh --prod --build
```

**éƒ¨ç½²è¿‡ç¨‹**ï¼ˆçº¦ 5-10 åˆ†é’Ÿï¼‰ï¼š
```
============================================
Starting Deployment: cohe-capital
============================================

[INFO] ğŸš€ Environment: PRODUCTION
[INFO] ğŸ“ Using: docker-compose.yml + docker-compose.prod.yml

============================================
Checking Prerequisites
============================================w
[SUCCESS] Docker is installed
[SUCCESS] Docker Compose is available
...

============================================
Building Docker Images
============================================
[INFO] Building all service images...
[INFO] This may take several minutes on first run...
...

============================================
Deploying Services
============================================
[INFO] Starting all services in detached mode...
[SUCCESS] All services started successfully
...

ğŸ‰ Deployment completed successfully!
```

---

### 3.4 éªŒè¯éƒ¨ç½²æˆåŠŸ

#### æ£€æŸ¥å®¹å™¨çŠ¶æ€

```bash
docker compose -f docker-compose.yml -f docker-compose.prod.yml ps
```

**æœŸæœ›è¾“å‡º**ï¼š
```
NAME          STATUS                PORTS
cohe-db       Up (healthy)
cohe-api      Up (healthy)
cohe-web      Up (healthy)
cohe-admin    Up (healthy)
cohe-nginx    Up (healthy)          0.0.0.0:80->80/tcp
```

æ‰€æœ‰æœåŠ¡éƒ½åº”è¯¥æ˜¯ **Up (healthy)** çŠ¶æ€ã€‚

---

#### æµ‹è¯•è®¿é—®

**æ–¹æ³• Aï¼šä½¿ç”¨ curlï¼ˆåœ¨æœåŠ¡å™¨ï¼‰**

```bash
# æµ‹è¯• Nginx å¥åº·æ£€æŸ¥
curl http://localhost/health
# åº”è¿”å›: healthy

# æµ‹è¯• API å¥åº·æ£€æŸ¥
curl http://localhost/api/healthz
# åº”è¿”å›: "ok"
```

**æ–¹æ³• Bï¼šä½¿ç”¨æµè§ˆå™¨**

å¦‚æœé…ç½®äº†åŸŸåï¼š
- è®¿é—® `http://cohe-capital.com`ï¼ˆWeb å‰ç«¯ï¼‰
- è®¿é—® `http://admin.cohe-capital.com`ï¼ˆAdmin åå°ï¼‰

å¦‚æœæ²¡æœ‰åŸŸåï¼Œä½¿ç”¨ IPï¼š
- è®¿é—® `http://123.45.67.89`ï¼ˆWeb å‰ç«¯ï¼‰
- è®¿é—® `http://123.45.67.89`ï¼ˆç”±äºæ²¡æœ‰å­åŸŸåï¼ŒAdmin éœ€è¦å•ç‹¬é…ç½®ï¼‰

---

## ğŸ‰ éƒ¨ç½²å®Œæˆï¼

### ä½ ç°åœ¨å¯ä»¥åšä»€ä¹ˆï¼Ÿ

1. **æµ‹è¯• Web å‰ç«¯**ï¼š
   - è®¿é—®ä½ çš„ç½‘ç«™
   - è¿æ¥é’±åŒ…ï¼ˆMetaMaskã€WalletConnect ç­‰ï¼‰
   - æµè§ˆä¿å•äº§å“

2. **ç™»å½• Admin åå°**ï¼š
   - è®¿é—® `http://admin.cohe-capital.com`
   - ä½¿ç”¨ä¹‹å‰ä¿å­˜çš„ **Admin Token** ç™»å½•
   - ç®¡ç†ä¿å•ã€æŸ¥çœ‹æ•°æ®

3. **æŸ¥çœ‹ API æ–‡æ¡£**ï¼š
   - è®¿é—® `http://cohe-capital.com/api-docs`
   - æŸ¥çœ‹ Swagger API æ–‡æ¡£

---

## ğŸ“ åç»­æ­¥éª¤ï¼ˆå¯é€‰ï¼‰

### é…ç½® HTTPSï¼ˆå¼ºçƒˆæ¨èï¼‰

```bash
# 1. å®‰è£… Certbot
sudo apt-get install certbot

# 2. åœæ­¢æœåŠ¡ï¼ˆä¸´æ—¶ï¼‰
docker compose -f docker-compose.yml -f docker-compose.prod.yml stop nginx

# 3. è·å–è¯ä¹¦
sudo certbot certonly --standalone \
  -d cohe-capital.com \
  -d www.cohe-capital.com \
  -d admin.cohe-capital.com \
  --email your@email.com \
  --agree-tos

# 4. å¤åˆ¶è¯ä¹¦
sudo mkdir -p infra/nginx/certs
sudo cp /etc/letsencrypt/live/cohe-capital.com/fullchain.pem infra/nginx/certs/
sudo cp /etc/letsencrypt/live/cohe-capital.com/privkey.pem infra/nginx/certs/
sudo chown -R $USER:$USER infra/nginx/certs/

# 5. é…ç½® Docker Compose
nano docker-compose.prod.yml
# å–æ¶ˆæ³¨é‡Šä»¥ä¸‹è¡Œï¼š
# - "443:443"
# - ./infra/nginx/certs:/etc/nginx/certs:ro

# 6. é…ç½® Nginx
nano infra/nginx/nginx.prod.conf
# å–æ¶ˆæ³¨é‡Š HTTPS server å—å’Œ HTTPâ†’HTTPS é‡å®šå‘

# 7. é‡å¯æœåŠ¡
./deploy.sh --prod
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: è„šæœ¬è¯¢é—®åŸŸåæ—¶ï¼Œæˆ‘è¿˜æ²¡æœ‰åŸŸåæ€ä¹ˆåŠï¼Ÿ

**å›ç­”**ï¼šç›´æ¥æŒ‰å›è½¦ï¼Œä½¿ç”¨å ä½ç¬¦ `your-domain.com`ã€‚

**æ³¨æ„**ï¼š
- ä½ å¯ä»¥å…ˆç”¨ IP è®¿é—®ç½‘ç«™ï¼ˆå¦‚ `http://123.45.67.89`ï¼‰
- Admin åå°éœ€è¦å•ç‹¬é…ç½®ï¼ˆæ²¡æœ‰å­åŸŸåï¼‰
- ä»¥åæœ‰åŸŸåäº†ï¼Œå†ä¿®æ”¹é…ç½®é‡æ–°éƒ¨ç½²

---

### Q2: æˆ‘å¿˜è®°ä¿å­˜ Admin Token äº†æ€ä¹ˆåŠï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥çœ‹ .env.production ä¸­çš„ ADMIN_TOKEN
grep ADMIN_TOKEN .env.production
```

---

### Q3: éƒ¨ç½²åè®¿é—®åŸŸåæ˜¾ç¤º 502 é”™è¯¯

**å¯èƒ½åŸå› **ï¼š
1. DNS è¿˜æœªç”Ÿæ•ˆï¼ˆç­‰å¾… 5-10 åˆ†é’Ÿï¼‰
2. é˜²ç«å¢™æœªå¼€æ”¾ç«¯å£
3. æœåŠ¡æœªæ­£å¸¸å¯åŠ¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker compose -f docker-compose.yml -f docker-compose.prod.yml ps

# æŸ¥çœ‹æ—¥å¿—
docker compose -f docker-compose.yml -f docker-compose.prod.yml logs -f
```

---

### Q4: é’±åŒ…ç™»å½•å¤±è´¥

**å¯èƒ½åŸå› **ï¼š`SIWE_DOMAIN` é…ç½®ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ .env.production
grep SIWE_DOMAIN .env.production

# åº”è¯¥æ˜¯ä½ çš„å®é™…åŸŸåï¼ˆä¸å¸¦ https://ï¼‰
# å¦‚æœä¸å¯¹ï¼Œä¿®æ”¹åé‡å¯ API
docker compose -f docker-compose.yml -f docker-compose.prod.yml restart api
```

---

## ğŸ“š æ›´å¤šæ–‡æ¡£

- **å®Œæ•´éƒ¨ç½²æ£€æŸ¥æ¸…å•**ï¼š`PRODUCTION_DEPLOY_CHECKLIST.md`
- **è¯¦ç»†éƒ¨ç½²æŒ‡å—**ï¼š`docs/PRODUCTION_DEPLOYMENT.md`
- **é…ç½®ä¿®å¤è¯´æ˜**ï¼š`docs/PRODUCTION_CONFIG_FIXES.md`

---

## ğŸ¯ æ€»ç»“

ä½ éœ€è¦åšçš„äº‹æƒ…å¾ˆç®€å•ï¼š

1. âœ… **è¿è¡Œå‡†å¤‡è„šæœ¬**ï¼š`./scripts/prepare-production.sh`
2. âœ… **å›ç­”ä¸¤ä¸ªé—®é¢˜**ï¼šåŸŸå + WalletConnect ID
3. âœ… **ä¿å­˜ Admin Token**ï¼ˆè„šæœ¬ä¼šæ˜¾ç¤ºï¼‰
4. âœ… **æäº¤ä»£ç **ï¼š`git push`
5. âœ… **æœåŠ¡å™¨éƒ¨ç½²**ï¼š`./deploy.sh --prod --build`

**å°±è¿™ä¹ˆç®€å•ï¼** ğŸš€
